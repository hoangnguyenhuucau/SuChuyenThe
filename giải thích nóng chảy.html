<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>So s√°nh N√≥ng ch·∫£y: K·∫øt tinh vs V√¥ ƒë·ªãnh h√¨nh</title>
<style>
  :root { --bg: #1e1e1e; --panel: #2d2d2d; --accent: #3498db; --fire: #e67e22; }
  body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #eee; margin: 0; height: 100vh; display: flex; overflow: hidden; }

  /* Layout chia 3 c·ªôt: Controls - M√¥ ph·ªèng - ƒê·ªì th·ªã */
  #layout { display: flex; width: 100%; height: 100%; }
  
  /* C·ªôt 1: ƒêi·ªÅu khi·ªÉn */
  #controls { width: 250px; background: var(--panel); padding: 20px; display: flex; flex-direction: column; gap: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.5); z-index: 10; }
  
  .control-group { background: #333; padding: 15px; border-radius: 8px; }
  h3 { margin: 0 0 10px 0; font-size: 1.1rem; color: var(--accent); }
  label { display: block; margin-bottom: 5px; font-size: 0.9rem; }
  
  /* Switch ch·ªçn lo·∫°i ch·∫•t */
  .type-btn { width: 100%; padding: 10px; margin-bottom: 5px; border: 1px solid #555; background: #444; color: #aaa; cursor: pointer; transition: 0.2s; border-radius: 4px; }
  .type-btn.active { background: var(--accent); color: white; border-color: var(--accent); font-weight: bold; }

  /* Thanh tr∆∞·ª£t ng·ªçn l·ª≠a */
  input[type=range] { width: 100%; cursor: pointer; }
  
  /* N√∫t reset */
  #btn-reset { background: #c0392b; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: auto; }
  #btn-reset:hover { background: #e74c3c; }

  /* C·ªôt 2: M√¥ ph·ªèng H·∫°t */
  #sim-container { flex: 1; position: relative; background: #000; border-right: 1px solid #444; display: flex; flex-direction: column; }
  #particleCanvas { flex: 1; display: block; width: 100%; }
  
  /* H·ªôp thuy·∫øt minh n·∫±m gi·ªØa tr√™n m√¥ ph·ªèng */
  #explainBox {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    max-width: 70%;
    background: rgba(0,0,0,0.8);
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 1rem;
    line-height: 1.7;
    border: 1px solid #555;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    z-index: 20;
  }
  #explainBox h4 {
    margin: 0 0 6px;
    font-size: 1.08rem;
    color: #f1c40f;
  }
  #explainBox p { margin: 4px 0; }

  /* H√¨nh ·∫£nh B·∫øp & C·ªëc */
  #lab-setup { height: 150px; background: #111; position: relative; border-top: 1px solid #333; }
  .beaker-base { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); width: 200px; height: 10px; background: #555; border-radius: 5px; }
  .flame { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 40px; height: 0px; background: radial-gradient(ellipse at bottom, #f1c40f 0%, #e67e22 60%, transparent 100%); transition: height 0.2s; filter: blur(2px); opacity: 0.8; border-radius: 50% 50% 20% 20%; }
  .heater-knob { position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); color: #888; font-size: 0.8rem; }

  /* C·ªôt 3: ƒê·ªì th·ªã & Nhi·ªát k·∫ø */
  #data-panel { width: 350px; background: #1a1a1a; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
  
  /* Nhi·ªát k·∫ø */
  #thermometer-box { display: flex; align-items: center; gap: 15px; background: #222; padding: 15px; border-radius: 8px; }
  .thermometer-tube { width: 20px; height: 150px; background: #444; border-radius: 10px; position: relative; border: 2px solid #666; overflow: hidden; }
  .thermometer-liquid { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: linear-gradient(to top, #3498db, #e74c3c); transition: height 0.2s; }
  .temp-readout { font-size: 2rem; font-weight: bold; font-family: monospace; color: #e74c3c; }

  /* ƒê·ªì th·ªã Canvas */
  #graph-container { flex: 1; background: #222; border-radius: 8px; position: relative; border: 1px solid #444; }
  #graphCanvas { width: 100%; height: 100%; display: block; }
  .graph-label { position: absolute; top: 10px; left: 10px; font-size: 0.8rem; color: #888; }

</style>
</head>
<body>

<div id="layout">
  <div id="controls">
    <h2>Ph√≤ng Th√≠ Nghi·ªám</h2>
    
    <div class="control-group">
      <h3>1. Ch·ªçn m·∫´u v·∫≠t ch·∫•t</h3>
      <button class="type-btn active" onclick="setMaterial('crystalline')">üíé Ch·∫•t r·∫Øn K·∫æT TINH<br><small>(S·∫Øt, BƒÉng phi·∫øn, N∆∞·ªõc ƒë√°)</small></button>
      <button class="type-btn" onclick="setMaterial('amorphous')">üïØÔ∏è Ch·∫•t r·∫Øn V√î ƒê·ªäNH H√åNH<br><small>(Th·ªßy tinh, Nh·ª±a ƒë∆∞·ªùng, N·∫øn)</small></button>
    </div>

    <div class="control-group">
      <h3>2. Ngu·ªìn Nhi·ªát (B·∫øp)</h3>
      <label>C√¥ng su·∫•t l·ª≠a:</label>
      <input type="range" id="fireSlider" min="0" max="100" value="0">
      <div style="text-align: right; color: var(--fire); font-weight: bold;" id="fireVal">T·∫Øt</div>
    </div>
    
    <div style="font-size: 0.85rem; color: #aaa; line-height: 1.4;">
      <strong>Quan s√°t:</strong>
      <ul style="padding-left: 20px; margin: 5px 0;">
        <li>Theo d√µi ƒë·ªì th·ªã nhi·ªát ƒë·ªô b√™n ph·∫£i.</li>
        <li>K·∫øt tinh: Nhi·ªát ƒë·ªô s·∫Ω <b>d·ª´ng l·∫°i</b> khi ƒëang tan ch·∫£y.</li>
        <li>V√¥ ƒë·ªãnh h√¨nh: Nhi·ªát ƒë·ªô <b>tƒÉng li√™n t·ª•c</b>.</li>
      </ul>
    </div>

    <button id="btn-reset" onclick="resetSim()">L√†m m·ªõi th√≠ nghi·ªám</button>
  </div>

  <div id="sim-container">
    <!-- H·ªôp thuy·∫øt minh n·∫±m gi·ªØa ph√≠a tr√™n -->
    <div id="explainBox"></div>

    <canvas id="particleCanvas"></canvas>
    
    <div id="lab-setup">
      <div class="beaker-base"></div>
      <div class="flame" id="flameVisual"></div>
      <div class="heater-knob">Ngu·ªìn n√≥ng</div>
      
      <div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px; pointer-events: none;">
        <span style="color: #3498db">‚óè R·∫Øn (Li√™n k·∫øt)</span> &nbsp; 
        <span style="color: #e74c3c">‚óè L·ªèng (T·ª± do)</span>
      </div>
    </div>
  </div>

  <div id="data-panel">
    <h3>Nhi·ªát k·∫ø ƒëi·ªán t·ª≠</h3>
    <div id="thermometer-box">
      <div class="thermometer-tube">
        <div class="thermometer-liquid" id="thermoLiquid"></div>
      </div>
      <div>
        <div class="temp-readout" id="tempText">20¬∞C</div>
        <div style="font-size: 0.8rem; color: #888;">Nhi·ªát ƒë·ªô m·∫´u v·∫≠t</div>
      </div>
    </div>

    <h3>ƒê·ªì th·ªã Nhi·ªát ƒë·ªô (T) / Th·ªùi gian (t)</h3>
    <div id="graph-container">
      <canvas id="graphCanvas"></canvas>
      <div class="graph-label">Tr·ª•c tung: Nhi·ªát ƒë·ªô (¬∞C) <br> Tr·ª•c ho√†nh: Th·ªùi gian</div>
    </div>
  </div>
</div>

<script>
/**
 * C·∫§U H√åNH V·∫¨T L√ù & BI·∫æN TO√ÄN C·ª§C
 */
const pCanvas = document.getElementById('particleCanvas');
const pCtx = pCanvas.getContext('2d');
const gCanvas = document.getElementById('graphCanvas');
const gCtx = gCanvas.getContext('2d');

let particles = [];
let materialType = 'crystalline'; // 'crystalline' ho·∫∑c 'amorphous'

// Th√¥ng s·ªë nhi·ªát ƒë·ªông l·ª±c h·ªçc
let heatPower = 0; // C√¥ng su·∫•t b·∫øp (0-100)
let systemTemp = 20; // Nhi·ªát ƒë·ªô b·∫Øt ƒë·∫ßu (20 ƒë·ªô C)
let latentHeatBuffer = 0; // B·ªô ƒë·ªám ·∫©n nhi·ªát (D√πng cho ch·∫•t k·∫øt tinh)
let time = 0; // Th·ªùi gian m√¥ ph·ªèng
let historyData = []; // D·ªØ li·ªáu v·∫Ω ƒë·ªì th·ªã

// H·∫±ng s·ªë V·∫≠t l√Ω gi·∫£ l·∫≠p
const MELTING_POINT = 80; // Nhi·ªát ƒë·ªô n√≥ng ch·∫£y c·ªßa ch·∫•t k·∫øt tinh
const LATENT_HEAT_CAPACITY = 2000;
const BOND_STRENGTH_CRYSTAL = 0.8;
const BOND_STRENGTH_AMORPHOUS_MIN = 0.2;
const BOND_STRENGTH_AMORPHOUS_MAX = 0.9;

/* ====== N·ªòI DUNG THUY·∫æT MINH ====== */
const EXPLAIN_IDLE_CRYSTAL = `
  <h4>Ch·∫•t r·∫Øn k·∫øt tinh ·ªü nhi·ªát ƒë·ªô ph√≤ng</h4>
  <p>C√°c ph√¢n t·ª≠ s·∫Øp x·∫øp r·∫•t <b>ngƒÉn n·∫Øp</b> trong m·∫°ng tinh th·ªÉ v√† ch·ªâ dao ƒë·ªông nh·∫π quanh v·ªã tr√≠ c√¢n b·∫±ng.
  Ch∆∞a c√≥ nhi·ªát l∆∞·ª£ng t·ª´ b·∫øp n√™n <b>nhi·ªát ƒë·ªô v·∫≠t r·∫Øn g·∫ßn nh∆∞ kh√¥ng ƒë·ªïi</b>.</p>
`;

const EXPLAIN_HEATING_CRYSTAL = `
  <h4>1. Tr∆∞·ªõc khi ƒë·∫°t nhi·ªát ƒë·ªô n√≥ng ch·∫£y</h4>
  <p>Khi <u>nung n√≥ng</u> m·ªôt v·∫≠t r·∫Øn k·∫øt tinh, c√°c <b>ph√¢n t·ª≠</b> c·ªßa v·∫≠t r·∫Øn <b>nh·∫≠n nhi·ªát l∆∞·ª£ng</b>.
  NƒÉng l∆∞·ª£ng nhi·ªát n√†y khi·∫øn <b>dao ƒë·ªông</b> c·ªßa c√°c ph√¢n t·ª≠ t·∫°i c√°c n√∫t m·∫°ng <b>m·∫°nh l√™n</b>,
  v√¨ v·∫≠y <b>v·∫≠n t·ªëc chuy·ªÉn ƒë·ªông nhi·ªát</b> tƒÉng v√† <b>nhi·ªát ƒë·ªô v·∫≠t r·∫Øn tƒÉng d·∫ßn</b>.</p>
`;

const EXPLAIN_MELTING_CRYSTAL = `
  <h4>2. ƒêang n√≥ng ch·∫£y ‚Äì nhi·ªát ƒë·ªô kh√¥ng ƒë·ªïi</h4>
  <p>Khi nhi·ªát ƒë·ªô ƒë·∫°t gi√° tr·ªã <b>n√≥ng ch·∫£y</b>, c√°c ph√¢n t·ª≠ th·∫Øng ƒë∆∞·ª£c <b>l·ª±c li√™n k·∫øt</b>
  v√† <b>tho√°t kh·ªèi v·ªã tr√≠ c√¢n b·∫±ng</b>. ƒê√¢y l√† s·ª± kh·ªüi ƒë·∫ßu c·ªßa <b>qu√° tr√¨nh n√≥ng ch·∫£y</b>.</p>
  <p><b>Nhi·ªát l∆∞·ª£ng</b> cung c·∫•p l√∫c n√†y ch·ªß y·∫øu d√πng ƒë·ªÉ <b>ph√° v·ª° c√°c li√™n k·∫øt trong m·∫°ng tinh th·ªÉ</b>,
  n√™n <b>kh√¥ng l√†m tƒÉng nhi·ªát ƒë·ªô</b> c·ªßa ch·∫•t. Tr√™n ƒë·ªì th·ªã, giai ƒëo·∫°n n√†y l√† ƒëo·∫°n <b>n·∫±m ngang</b>.</p>
`;

const EXPLAIN_LIQUID_CRYSTAL = `
  <h4>3. Sau khi n√≥ng ch·∫£y ho√†n to√†n</h4>
  <p>Khi <b>tr·∫≠t t·ª± tinh th·ªÉ</b> ƒë√£ b·ªã ph√° v·ª° ho√†n to√†n, to√†n b·ªô m·∫´u v·∫≠t chuy·ªÉn sang <b>th·ªÉ l·ªèng</b>.</p>
  <p>N·∫øu ti·∫øp t·ª•c ƒëun, <b>nhi·ªát ƒë·ªô ch·∫•t l·ªèng l·∫°i tƒÉng d·∫ßn</b>, c√°c ph√¢n t·ª≠ chuy·ªÉn ƒë·ªông h·ªón lo·∫°n v√† kh√¥ng c√≤n
  v·ªã tr√≠ c·ªë ƒë·ªãnh nh∆∞ ban ƒë·∫ßu.</p>
`;

const EXPLAIN_AMORPHOUS = `
  <h4>Ch·∫•t r·∫Øn v√¥ ƒë·ªãnh h√¨nh khi nung n√≥ng</h4>
  <p>Trong ch·∫•t r·∫Øn <b>v√¥ ƒë·ªãnh h√¨nh</b> (th·ªßy tinh, nh·ª±a ƒë∆∞·ªùng, n·∫øn...), c√°c li√™n k·∫øt gi·ªØa ph√¢n t·ª≠ <b>kh√¥ng ƒë·ªìng ƒë·ªÅu</b>.</p>
  <p>Khi nung n√≥ng, c√°c v√πng li√™n k·∫øt y·∫øu <b>m·ªÅm ra tr∆∞·ªõc</b>, r·ªìi d·∫ßn d·∫ßn ƒë·∫øn v√πng li√™n k·∫øt m·∫°nh h∆°n.
  Do ƒë√≥ <b>kh√¥ng c√≥ m·ªôt nhi·ªát ƒë·ªô n√≥ng ch·∫£y x√°c ƒë·ªãnh</b>: nhi·ªát ƒë·ªô c·ªßa m·∫´u v·∫≠t <b>tƒÉng li√™n t·ª•c</b>,
  ƒë·ªì th·ªã <b>kh√¥ng c√≥ ƒëo·∫°n n·∫±m ngang r√µ r·ªát</b>.</p>
`;

/* H√†m c·∫≠p nh·∫≠t n·ªôi dung thuy·∫øt minh */
function setExplanation(html) {
  document.getElementById('explainBox').innerHTML = html;
}

function updateExplanation() {
  if (materialType === 'crystalline') {
    const bondedCount = particles.filter(p => p.isBonded).length;
    const total = particles.length || 1;
    const liquidRatio = (total - bondedCount) / total;

    if (heatPower === 0 && systemTemp <= 25) {
      setExplanation(EXPLAIN_IDLE_CRYSTAL);
    } else if (systemTemp < MELTING_POINT - 2) {
      setExplanation(EXPLAIN_HEATING_CRYSTAL);
    } else if (systemTemp >= MELTING_POINT - 2 && bondedCount > 0) {
      setExplanation(EXPLAIN_MELTING_CRYSTAL);
    } else if (liquidRatio > 0.95) {
      setExplanation(EXPLAIN_LIQUID_CRYSTAL);
    } else {
      setExplanation(EXPLAIN_MELTING_CRYSTAL);
    }
  } else {
    setExplanation(EXPLAIN_AMORPHOUS);
  }
}

/* ====== H·∫æT PH·∫¶N THUY·∫æT MINH ====== */

// Resize canvas
function resize() {
  pCanvas.width = pCanvas.parentElement.offsetWidth;
  pCanvas.height = pCanvas.parentElement.offsetHeight - 150; // ch·ª´a ch·ªó cho lab-setup
  gCanvas.width = gCanvas.parentElement.offsetWidth;
  gCanvas.height = gCanvas.parentElement.offsetHeight;
  if(particles.length === 0) initParticles();
}
window.addEventListener('resize', resize);

/**
 * CLASS H·∫†T
 */
class Particle {
  constructor(x, y, isFixedGrid) {
    this.x = x; this.y = y;
    this.vx = 0; this.vy = 0;
    this.originX = x; this.originY = y;
    this.isBonded = true; 
    if (isFixedGrid) {
        this.bondEnergy = 1.0;
    } else {
        this.bondEnergy = 0.5 + Math.random() * 0.5;
    }
  }
}

/**
 * KH·ªûI T·∫†O H·ªÜ TH·ªêNG
 */
function initParticles() {
  particles = [];
  const rows = 12; const cols = 20;
  const spacing = 25;
  const startX = (pCanvas.width - cols * spacing) / 2 + spacing/2;
  const startY = pCanvas.height - (rows * spacing) - 20;

  for(let r=0; r<rows; r++) {
    for(let c=0; c<cols; c++) {
      let x = startX + c * spacing;
      let y = startY + r * spacing;

      if (materialType === 'crystalline') {
        if (r % 2 !== 0) x += spacing / 2;
        particles.push(new Particle(x, y, true));
      } else {
        let randX = (Math.random() - 0.5) * 15;
        let randY = (Math.random() - 0.5) * 15;
        particles.push(new Particle(x + randX, y + randY, false));
      }
    }
  }
}

/**
 * LOGIC V·∫¨T L√ù CH√çNH (LOOP)
 */
function updatePhysics() {
  if (heatPower > 0) {
      let energyInput = heatPower * 0.05; 
      
      if (materialType === 'crystalline') {
          if (systemTemp >= MELTING_POINT) {
              let bondedCount = particles.filter(p => p.isBonded).length;
              
              if (bondedCount > 0) {
                  latentHeatBuffer += energyInput * 5; 
                  if (latentHeatBuffer > 10) { 
                      let bondedParticles = particles.filter(p => p.isBonded);
                      if (bondedParticles.length > 0) {
                          let p = bondedParticles[Math.floor(Math.random() * bondedParticles.length)];
                          p.isBonded = false;
                      }
                      latentHeatBuffer = 0;
                  }
                  systemTemp = MELTING_POINT + (Math.random() - 0.5); 
              } else {
                  systemTemp += energyInput * 0.5;
              }
          } else {
              systemTemp += energyInput;
          }
      } else {
          systemTemp += energyInput;
          particles.forEach(p => {
              if (p.isBonded) {
                  let threshold = 40 + p.bondEnergy * 100;
                  if (systemTemp > threshold) p.isBonded = false;
              }
          });
      }
  } else {
      if (systemTemp > 20) systemTemp -= 0.1;
  }

  particles.forEach(p => {
      let vibration = systemTemp * 0.02;
      p.vx += (Math.random() - 0.5) * vibration;
      p.vy += (Math.random() - 0.5) * vibration;

      if (p.isBonded) {
          let k = (materialType === 'amorphous') ? 0.05 : 0.1;
          p.vx += (p.originX - p.x) * k;
          p.vy += (p.originY - p.y) * k;
          p.vx *= 0.8; p.vy *= 0.8;
      } else {
          p.vy += 0.2;
          let maxSpeed = 2;
          p.vx = Math.max(-maxSpeed, Math.min(maxSpeed, p.vx));
          p.vy = Math.max(-maxSpeed, Math.min(maxSpeed, p.vy));
          p.vx *= 0.95; p.vy *= 0.95;
      }
      
      particles.forEach(other => {
          if (p === other) return;
          let dx = p.x - other.x;
          let dy = p.y - other.y;
          let distSq = dx*dx + dy*dy;
          if (distSq < 100) {
              let dist = Math.sqrt(distSq);
              let force = (10 - dist) * 0.2;
              let angle = Math.atan2(dy, dx);
              p.vx += Math.cos(angle) * force;
              p.vy += Math.sin(angle) * force;
          }
      });

      p.x += p.vx;
      p.y += p.vy;

      if (p.x < 5) { p.x = 5; p.vx *= -0.5; }
      if (p.x > pCanvas.width - 5) { p.x = pCanvas.width - 5; p.vx *= -0.5; }
      if (p.y > pCanvas.height - 5) { p.y = pCanvas.height - 5; p.vy *= -0.5; }
      if (p.y < 5) { p.y = 5; p.vy *= -0.5; }
  });

  if (time % 10 === 0) {
      historyData.push(systemTemp);
      if (historyData.length > gCanvas.width) historyData.shift();
  }
  time++;

  updateExplanation();
}

/**
 * V·∫º H√åNH
 */
function draw() {
  pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
  
  particles.forEach(p => {
    pCtx.beginPath();
    pCtx.arc(p.x, p.y, 5, 0, Math.PI*2);
    pCtx.fillStyle = p.isBonded ? '#3498db' : '#e74c3c';
    pCtx.fill();
    pCtx.strokeStyle = "rgba(255,255,255,0.2)";
    pCtx.stroke();
  });

  if (materialType === 'crystalline') {
      pCtx.strokeStyle = "rgba(255,255,255,0.1)";
      pCtx.beginPath();
      particles.forEach(p => {
          if (!p.isBonded) return;
          particles.forEach(other => {
              if (!other.isBonded || p === other) return;
              let dx = p.x - other.x;
              let dy = p.y - other.y;
              if (Math.abs(dx) < 30 && Math.abs(dy) < 30) {
                  pCtx.moveTo(p.x, p.y);
                  pCtx.lineTo(other.x, other.y);
              }
          });
      });
      pCtx.stroke();
  }

  let heightPercent = Math.min(100, (systemTemp / 150) * 100);
  document.getElementById('thermoLiquid').style.height = heightPercent + "%";
  document.getElementById('tempText').innerText = Math.round(systemTemp) + "¬∞C";

  drawGraph();

  updatePhysics();
  requestAnimationFrame(draw);
}

function drawGraph() {
    gCtx.clearRect(0, 0, gCanvas.width, gCanvas.height);
    
    gCtx.strokeStyle = "#333";
    gCtx.lineWidth = 1;
    gCtx.beginPath();
    let meltY = gCanvas.height - (MELTING_POINT / 150) * gCanvas.height;
    gCtx.moveTo(0, meltY);
    gCtx.lineTo(gCanvas.width, meltY);
    gCtx.stroke();
    
    gCtx.fillStyle = "#666";
    gCtx.fillText("80¬∞C", 5, meltY - 5);

    if (historyData.length < 2) return;
    
    gCtx.beginPath();
    gCtx.strokeStyle = "#e67e22";
    gCtx.lineWidth = 2;
    
    for (let i = 0; i < historyData.length; i++) {
        let t = historyData[i];
        let x = i;
        let y = gCanvas.height - (t / 150) * gCanvas.height;
        if (i === 0) gCtx.moveTo(x, y);
        else gCtx.lineTo(x, y);
    }
    gCtx.stroke();
    
    let lastX = historyData.length - 1;
    let lastY = gCanvas.height - (systemTemp / 150) * gCanvas.height;
    gCtx.fillStyle = "white";
    gCtx.beginPath();
    gCtx.arc(lastX, lastY, 3, 0, Math.PI*2);
    gCtx.fill();
}

/**
 * X·ª¨ L√ù S·ª∞ KI·ªÜN UI
 */
const fireSlider = document.getElementById('fireSlider');
const fireVal = document.getElementById('fireVal');
const flameVisual = document.getElementById('flameVisual');
const btns = document.querySelectorAll('.type-btn');

fireSlider.addEventListener('input', (e) => {
    heatPower = parseInt(e.target.value);
    if (heatPower === 0) {
        fireVal.innerText = "T·∫Øt";
        flameVisual.style.height = "0px";
    } else {
        fireVal.innerText = heatPower + "%";
        flameVisual.style.height = (heatPower * 0.8) + "px"; 
    }
});

function setMaterial(type) {
    materialType = type;
    btns.forEach(b => b.classList.remove('active'));
    if (type === 'crystalline') btns[0].classList.add('active');
    else btns[1].classList.add('active');
    
    resetSim();
}

function resetSim() {
    systemTemp = 20;
    heatPower = 0;
    latentHeatBuffer = 0;
    time = 0;
    historyData = [];
    
    fireSlider.value = 0;
    fireVal.innerText = "T·∫Øt";
    flameVisual.style.height = "0px";
    
    initParticles();
    updateExplanation();
}

// Ch·∫°y
resize();
initParticles();
updateExplanation();
draw();

</script>
</body>
</html>
